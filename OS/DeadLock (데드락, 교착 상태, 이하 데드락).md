# DeadLock (데드락, 교착 상태, 이하 데드락)

데드락는 공유 자원에 대해서 타 프로세스가 선점한 자원을 필요로 하고 그 선점한 프로세스도 타 프로스세의 선점 자원을 원해 서로 무한정 기다리게 되는 것입니다.



> 간단한 비유를 하자면 수저가 있고 두 사람이 각각 숟가락, 젓가락을 나눠 가졌습니다.
>
> 밥을 먹기 위해서는 수저를 완성해야 하는데 이 둘은 각자의 도구를 놓을 생각이 없기에 서로 밥을 못먹게 되는 이야기 입니다.



## 데드락의 발생 조건

데드락의 경우 아래 4 조건이 동시에 지켜지면 발생하게 됩니다.

- 공유 자원에 대한 **상호 배제**를 하고 있을 때
- 자원을 보유할 채 추가적인 자원을 위해 기다리고 있을 때 **(점유와 대기)**
- **비선점**(No Preemptive)
  - 다른 프로세스 종료가 안되는 경우
- 자원 관계에 있어서 **사이클**이 있을 때 
  - 원하는 자원 -> 가지는 프로세스로 그래프를 그릴 때 사이클이 있는 경우

특히 위 '상호 배제'는 반드시 지켜야 하는 부분입니다.



## 데드락 방지, 해결

위 `데드락 발생 조건` 4가지중 1개라도 사라지면 해결이 가능합니다. 다만 위에 언급한대로 1번, `상호배제`의 경우 제거하면 안됩니다. 때문에 남은 3개에 초점을 맞춰 해결을 하게 됩니다.

+ 예방
  + **상호배제 삭제** :

    모든 자원이 공유 가능하게 되어 동기화 문제 밑 혼란이 생깁니다.
  + **점유와 대기 삭제** :

    특정 프로세스에 자원을 몰아주거나 아예 주지 않으므로(all or nothing) 자원의 활용률이 낮아집니다.
  + **비선점 삭제** :

    선점이 불가능한 프로세스의 자원을 탈취할 수 있어 범용성이 떨어집니다.
  + **원형 대기 삭제** :

    모든 자원에 번호를 붙여 숫자가 큰 방향으로만 자원을 할당합니다. 큰 번호를 사용하면 작은 번호를 사용할 수 없기 때문에, 붙이는 번호에 따라 특정 자원의 활용률이 떨어질 수 있습니다.
+ 회피 : 교착상태가 발생하지 않을 정도로 조금씩 자원을 할당합니다. 안전 순서열에 따라 요구량만큼 자원을 배분합니다. [(은행원 알고리즘)](https://velog.io/@seung_min/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EA%B5%90%EC%B0%A9%EC%83%81%ED%83%9C%EC%9D%98-%ED%95%B4%EA%B2%B0)
   + 장점 -> 시스템의 운영방식에 변경을 가하지 않기 때문에 교착상태 예방보다 유연합니다.
   + 단점 -> 프로세스가 자신이 사용할 모든 자원을 제공하지 않았거나, 변동이 있으면 불안전 상태가 되기 쉽습니다.
+ 검출과 회복 
  + **타임 아웃** :
    
    일정시간동안 작업이 진행되지 않는 프로세스를 교착상태가 발생한 것으로 처리하는 방법입니다. 적중률은 떨어지나, 데이터베이스와 운영체제에서 많이 선호합니다.
  + **자원 할당 그래프** :
    
    그래프를 그려 사이클이 발생하면 검출된 것으로 판단합니다.

  + 교착상태가 검출되면 교착상태에 놓인 모든 프로세스즐 종료하거나, 하나씩 종료하여 회복합니다. 전자는 많은 프로세스들이 작업내역을 잃을 수 있고, 후자는 교착상태가 사라졌는지 확인하는 과정에서 오버헤드가 생길 수 있습니다.
+ 무시 : 그냥 무시합니다 (타조 알조리즘)


교착상태 예방은 실제로 구현하기 어렵고 교착상태 회피는 구현할 수는 있지만 자원을 낭비하는 등의 여러가지 문제점이 있습니다. 교착상태 검출이라는 그 중에서 가장 현실적인 해결방법일 수 있습니다.


